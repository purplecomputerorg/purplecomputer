<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<!--
  Purple Computer: Force color emoji.

  Problem: Some fonts (DejaVu, Symbola) have monochrome emoji glyphs that
  can win over Noto Color Emoji in fallback chains.

  Solution:
  1. Reject known monochrome emoji fonts
  2. Use alias rules to prefer Noto Color Emoji for common font families
  3. Append Noto Color Emoji as fallback for all requests

  Install to: /etc/fonts/conf.d/99-emoji.conf
-->
<fontconfig>

  <!-- Reject fonts with monochrome emoji glyphs entirely -->
  <selectfont>
    <rejectfont>
      <pattern><patelt name="family"><string>Noto Emoji</string></patelt></pattern>
    </rejectfont>
    <rejectfont>
      <pattern><patelt name="family"><string>Symbola</string></patelt></pattern>
    </rejectfont>
    <rejectfont>
      <pattern><patelt name="family"><string>EmojiOne</string></patelt></pattern>
    </rejectfont>
    <!-- DejaVu has some monochrome emoji (cat U+1F431, etc) -->
    <rejectfont>
      <pattern><patelt name="family"><string>DejaVu Sans</string></patelt></pattern>
    </rejectfont>
    <rejectfont>
      <pattern><patelt name="family"><string>DejaVu Serif</string></patelt></pattern>
    </rejectfont>
    <rejectfont>
      <pattern><patelt name="family"><string>DejaVu Sans Mono</string></patelt></pattern>
    </rejectfont>
  </selectfont>

  <!-- Prefer Noto Color Emoji for generic font families -->
  <alias binding="strong">
    <family>sans-serif</family>
    <prefer><family>Noto Color Emoji</family></prefer>
  </alias>

  <alias binding="strong">
    <family>serif</family>
    <prefer><family>Noto Color Emoji</family></prefer>
  </alias>

  <alias binding="strong">
    <family>monospace</family>
    <prefer><family>Noto Color Emoji</family></prefer>
  </alias>

  <!-- Append Noto Color Emoji as fallback for all font requests -->
  <match target="pattern">
    <edit name="family" mode="append">
      <string>Noto Color Emoji</string>
    </edit>
  </match>

</fontconfig>
