#!/bin/bash
set -e
error=0 ; trap 'error=$(($?>$error?$?:$error))' ERR

echo "Setting up Purple Computer TUI..."

USERNAME="purple"

# Auto-start X with Alacritty on login
cat > $target/home/$USERNAME/.bash_profile <<'EOF'
if [ -z "$DISPLAY" ] && [ "$(tty)" = "/dev/tty1" ]; then
    exec startx
fi
EOF

# .xinitrc - just run Alacritty fullscreen
cat > $target/home/$USERNAME/.xinitrc <<'EOF'
#!/bin/sh
exec alacritty --option window.decorations=none
EOF

chmod +x $target/home/$USERNAME/.xinitrc

# Configure auto-login on tty1
mkdir -p $target/etc/systemd/system/getty@tty1.service.d
cat > $target/etc/systemd/system/getty@tty1.service.d/autologin.conf <<EOF
[Service]
ExecStart=
ExecStart=-/sbin/agetty --autologin $USERNAME --noclear %I \$TERM
EOF

$ROOTCMD chown -R $USERNAME:$USERNAME /home/$USERNAME

echo "Purple TUI setup complete."
exit $error
